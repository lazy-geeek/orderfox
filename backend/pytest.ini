[pytest]
# Fix pytest-asyncio deprecation warning
asyncio_default_fixture_loop_scope = function

# Test discovery patterns
python_files = test_*.py *_test.py
python_classes = Test*
python_functions = test_*

# Optimized output for result logging (can be overridden by command line)
addopts = -v --tb=short

# Warning filters for clean development experience
# NOTE: The chunked test script captures ALL warnings for analysis
# These filters only affect direct pytest execution (development, IDE, CI)
filterwarnings =
    # External library warnings (not actionable by our team)
    ignore:Use 'content=<...>' to upload raw bytes/text content.*:DeprecationWarning:httpx
    ignore:coroutine 'Connection._cancel' was never awaited.*:RuntimeWarning
    ignore:enable_cleanup_closed ignored.*:DeprecationWarning:aiohttp.connector
    ignore:Exception ignored from cffi callback.*:pytest.PytestUnraisableExceptionWarning
    
    # IMPORTANT: Only add warnings here that are confirmed external library issues
    # All warnings from our code should remain visible for immediate feedback

# Markers for chunked test execution (following logical dependency order)
markers =
    # Legacy markers
    integration: marks tests as integration tests (may require network/external services)
    slow: marks tests as slow running
    unit: marks tests as unit tests (default)
    
    # Chunked execution markers (logical dependency order)
    chunk1: Foundation tests - Database, config, utilities (~30s)
    chunk2: Core services - Symbol, exchange, formatting, caching (~45s)
    chunk3: Business services - Bot, orderbook, chart data (~60s)
    chunk4: Advanced services - Liquidation, trade, trading engine (~60s)
    chunk5: REST API endpoints - Schema, bot, market data APIs (~45s)
    chunk6: WebSocket API endpoints - Connection manager, market data, liquidations WS (~75s)
    chunk7a: Bot Integration tests - Bot paper trading flows (~45s)
    chunk7b: Data Flow Integration tests - E2E formatting, liquidation volume flows (~60s)
    chunk7c: WebSocket Integration tests - Real WebSocket orderbook tests (~90s)
    chunk8a: Integration & E2E Tests - End-to-end data flow validation (~30s)
    chunk8b: Performance Tests - Response times, throughput, memory efficiency (~45s)
    chunk8d: Basic Load Tests - Aggregation latency, throughput, cache performance (~45s)
    chunk8e: Connection & Memory Tests - Connection performance, memory scaling (~60s)
    chunk8f: Scalability & Concurrency Tests - System limits, sustained load (~90s)
    chunk8g: Extended Load Tests - High-volume scenarios, extended runtime (~120s)